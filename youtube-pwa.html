<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Premium PWA</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://www.youtube.com/s/desktop/1bfa1e55/img/favicon_144x144.png">
    <link href="https://fonts.googleapis.com/css?family=Roboto:400,700" rel="stylesheet">
    <style>
        html, body { height: 100%; }
        body {
            min-height: 100vh;
            background: #181818;
            color: #fff;
            font-family: 'Roboto', Arial, sans-serif;
            margin: 0;
            display: flex;
            flex-direction: column;
        }
        .yt-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: #202020;
            color: #fff;
            padding: 10px 16px;
            position: sticky;
            top: 0;
            z-index: 10;
            box-shadow: 0 2px 5px rgba(0,0,0,0.18);
        }
        .yt-logo img { height: 32px; border-radius: 7px; }
        .search-bar { flex: 1; display: flex; max-width: 400px; margin: 0 20px; }
        .search-bar input {
            width: 100%; padding: 6px 12px; border-radius: 20px 0 0 20px; border: none;
            background: #303030; color: #fff; outline: none; font-size: 1rem;
        }
        .search-bar button {
            padding: 7px 18px; border: none; background: #ff0000; color: #fff;
            border-radius: 0 20px 20px 0; cursor: pointer; font-size: 1rem;
            transition: background 0.2s;
        }
        .search-bar button:hover { background: #d20000; }
        .yt-actions button {
            background: none; border: none; color: #fff; font-size: 1.4rem; margin-left: 12px; cursor: pointer;
            transition: color 0.2s;
        }
        .yt-actions button:hover { color: #ff0000; }
        .main-content {
            display: flex; flex-direction: column; align-items: center; margin-top: 24px; flex: 1;
        }
        .yt-player-container {
            background: #000; border-radius: 16px; overflow: hidden;
            box-shadow: 0 0 20px #0006; width: 100%; max-width: 520px;
            position: relative; margin-bottom: 18px;
        }
        .yt-player {
            width: 100%; aspect-ratio: 16/9; border: none; display: block;
        }
        .yt-controls {
            display: flex; align-items: center; justify-content: space-between;
            padding: 10px 18px; background: #181818;
        }
        .yt-controls .left, .yt-controls .right { display: flex; align-items: center; }
        .yt-controls button, .yt-controls select {
            background: none; border: none; color: #fff; margin: 0 6px;
            font-size: 1.2rem; cursor: pointer; padding: 4px 8px; border-radius: 4px;
            transition: background 0.2s, color 0.2s;
        }
        .yt-controls button:hover, .yt-controls select:hover { background: #222; color: #ff0000; }
        .yt-video-title {
            padding: 12px 0 2px 0; font-size: 1.2rem; font-weight: bold; text-align: right;
        }
        .yt-channel {
            color: #aaa; font-size: 1rem; text-align: right; padding-bottom: 12px;
        }
        .proxy-select-container {
            margin: 10px 0 18px 0;
            text-align: center;
        }
        .proxy-select-container select {
            background: #232323; color: #fff; border: 1px solid #444;
            padding: 5px 14px; border-radius: 9px; font-size: 1rem;
            margin-right: 7px;
        }
        .status {
            margin: 10px 0 0 0; color: #aaa; font-size: 0.98rem; text-align: center;
        }
        .instructions {
            margin: 20px 0 0 0;
            padding: 16px;
            background: rgba(255,255,255,0.04);
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.09);
            max-width: 520px;
            color: #eee;
            text-align: right;
        }
        .instructions h3 {
            color: #ff5a5a;
            margin-bottom: 13px;
        }
        .instructions ol { padding-right: 20px; }
        .instructions li { margin-bottom: 8px; line-height: 1.5; }
        @media (max-width: 600px) {
            .main-content { margin-top: 12px; }
            .yt-player-container { max-width: 100vw; }
            .yt-header { flex-direction: column; gap: 10px; }
            .search-bar { margin: 0; width: 100%; }
            .instructions { padding: 10px; }
        }
    </style>
</head>
<body>
    <div class="yt-header">
        <div class="yt-logo">
            <img src="https://www.youtube.com/s/desktop/1bfa1e55/img/favicon_144x144.png" alt="YouTube Logo">
        </div>
        <form class="search-bar" id="ytSearchForm" onsubmit="return false;">
            <input type="text" id="ytSearchInput" placeholder="חפש ביוטיוב..." autocomplete="off">
            <button id="ytSearchBtn">🔍</button>
        </form>
        <div class="yt-actions">
            <button title="התראות">🔔</button>
            <button title="החשבון שלי">👤</button>
        </div>
    </div>
    <div class="main-content">
        <div class="proxy-select-container">
            <label for="proxySelect">שרת פרוקסי:</label>
            <select id="proxySelect"></select>
        </div>
        <div class="yt-player-container">
            <iframe id="ytIframe" class="yt-player"
                src="https://yewtu.be/embed?v=JGwWNGJdvx8"
                allowfullscreen allow="picture-in-picture; encrypted-media">
            </iframe>
            <div class="yt-controls">
                <div class="left">
                    <button title="פלייליסט" onclick="playlistAlert()">▶️</button>
                    <button title="לייק">👍</button>
                    <button title="שתף" onclick="shareVideo()">🔗</button>
                    <button title="הורדה" onclick="downloadVideo()">⬇️</button>
                </div>
                <div class="right">
                    <select id="ytQuality">
                        <option value="auto">Auto</option>
                        <option value="hd">HD</option>
                        <option value="sd">SD</option>
                    </select>
                    <button title="הגדרות" onclick="settingsAlert()">⚙️</button>
                    <button title="מסך מלא" onclick="toggleFullscreen()">⛶</button>
                </div>
            </div>
            <div class="yt-video-title" id="ytTitle">Shape of You (Ed Sheeran)</div>
            <div class="yt-channel" id="ytChannel">Ed Sheeran - 6.2B צפיות</div>
        </div>
        <div class="status" id="statusText">בודק שרתים זמינים...</div>
        <div class="instructions" id="instructions">
            <h3>הוראות התקנה:</h3>
            <ol>
                <li>לחץ על "הוסף למסך הבית" (דרך כפתור השיתוף בדפדפן)</li>
                <li>לאחר ההתקנה, תוכל להפעיל את האפליקציה כממשק יוטיוב מלא ללא פרסומות</li>
                <li>ניתן לחפש ולנגן כל סרטון ישירות מהמסך הראשי</li>
            </ol>
        </div>
    </div>
    <script>
        // רשימת פרוקסים עדכנית
        const WORKING_PROXIES = [
            { name: "yewtu.be", url: "https://yewtu.be" },
            { name: "vid.puffyan.us", url: "https://vid.puffyan.us" },
            { name: "inv.riverside.rocks", url: "https://inv.riverside.rocks" },
            { name: "invidious.snopyta.org", url: "https://invidious.snopyta.org" }
        ];
        let currentProxyIdx = 0;
        let currentProxy = WORKING_PROXIES[0];
        const proxySelect = document.getElementById('proxySelect');
        const statusEl = document.getElementById('statusText');
        const ytIframe = document.getElementById('ytIframe');
        const ytTitle = document.getElementById('ytTitle');
        const ytChannel = document.getElementById('ytChannel');
        let currentVid = "JGwWNGJdvx8"; // ברירת מחדל: Ed Sheeran Shape of You

        // מילוי תפריט שרתי פרוקסי
        function populateProxyList() {
            proxySelect.innerHTML = '';
            WORKING_PROXIES.forEach((proxy, idx) => {
                const opt = document.createElement('option');
                opt.value = idx;
                opt.textContent = proxy.name;
                proxySelect.appendChild(opt);
            });
            proxySelect.value = currentProxyIdx;
        }
        // בדיקת זמינות שרתים (פשוטה)
        async function checkProxies() {
            statusEl.textContent = "בודק שרתים זמינים...";
            let found = false;
            for (let i = 0; i < WORKING_PROXIES.length; i++) {
                try {
                    await fetch(WORKING_PROXIES[i].url + "/", { method: 'HEAD', mode: 'no-cors', cache: 'no-store' });
                    currentProxyIdx = i;
                    currentProxy = WORKING_PROXIES[i];
                    statusEl.textContent = `מחובר אל: ${currentProxy.name}`;
                    proxySelect.value = i;
                    found = true;
                    break;
                } catch (e) {}
            }
            if (!found) statusEl.textContent = "אף שרת לא זמין. נסה שוב מאוחר יותר.";
        }
        proxySelect.addEventListener('change', () => {
            currentProxyIdx = parseInt(proxySelect.value);
            currentProxy = WORKING_PROXIES[currentProxyIdx];
            loadVideo(currentVid);
            statusEl.textContent = `שרת נבחר: ${currentProxy.name}`;
        });
        function loadVideo(videoId, title = "", channel = "") {
            ytIframe.src = `${currentProxy.url}/embed?v=${videoId}`;
            currentVid = videoId;
            if (title) ytTitle.textContent = title;
            if (channel) ytChannel.textContent = channel;
        }
        // חיפוש סרטון ב-Invidious
        document.getElementById("ytSearchBtn").onclick = function() {
            let q = document.getElementById("ytSearchInput").value.trim();
            if (!q) return;
            statusEl.textContent = "מחפש...";
            fetch(`${currentProxy.url}/api/v1/search?q=${encodeURIComponent(q)}&type=video`)
                .then(r => r.json())
                .then(results => {
                    if (results && results.length > 0) {
                        let vid = results[0].videoId;
                        let title = results[0].title;
                        let channel = results[0].author + (results[0].viewCount ? " - " + formatViews(results[0].viewCount) + " צפיות" : "");
                        loadVideo(vid, title, channel);
                        statusEl.textContent = "נמצא סרטון: " + title;
                    } else {
                        statusEl.textContent = "לא נמצאו תוצאות.";
                    }
                }).catch(() => statusEl.textContent = "שגיאת חיפוש.");
        };
        // תבנית צפיות
        function formatViews(n) {
            n = parseInt(n);
            if (n >= 1e9) return (n/1e9).toFixed(1) + "B";
            if (n >= 1e6) return (n/1e6).toFixed(1) + "M";
            if (n >= 1e3) return (n/1e3).toFixed(1) + "K";
            return n;
        }
        // שתף סרטון
        function shareVideo() {
            const url = `${currentProxy.url}/watch?v=${currentVid}`;
            if (navigator.share) {
                navigator.share({ title: ytTitle.textContent, url: url });
            } else {
                navigator.clipboard.writeText(url);
                alert("הקישור הועתק!");
            }
        }
        // הורדה (הורדה מדומה)
        function downloadVideo() {
            const url = `${currentProxy.url}/latest_version?id=${currentVid}`;
            window.open(url, "_blank");
        }
        // מסך מלא
        function toggleFullscreen() {
            if (ytIframe.requestFullscreen) ytIframe.requestFullscreen();
            else if (ytIframe.webkitRequestFullscreen) ytIframe.webkitRequestFullscreen();
            else alert("הדפדפן לא תומך במסך מלא");
        }
        // פלייליסט
        function playlistAlert() {
            alert('הצגת פלייליסט תומכת רק באימבד של Invidious עם פלייליסט. ניתן להיכנס לקישור המלא.');
        }
        // הגדרות
        function settingsAlert() {
            alert('אפשרויות הגדרות מתקדמות יתווספו בקרוב!');
        }
        // איכות (הודעה בלבד)
        document.getElementById("ytQuality").onchange = function() {
            alert('החלפת איכות לא נתמכת ישירות ב-Invidious Embed. שנה איכות בדף המקורי אם צריך.');
        };
        // הפעלת שרתי פרוקסי בחיבור
        window.addEventListener('load', async () => {
            populateProxyList();
            await checkProxies();
        });
        // ויברציה בלחיצה
        document.getElementById('ytSearchBtn').addEventListener('touchstart', () => {
            if (navigator.vibrate) navigator.vibrate(24);
        });
    </script>
</body>
</html>
